<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multiplication Rapid-Fire Quiz (Bootstrap)</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#f7fbff; }
    .question-box { background:#eef4ff; border-radius:12px; padding:20px; }
    .question { font-size:2.2rem; font-weight:700; }
    .review-row.correct { background:#e8fbea; }
    .review-row.wrong { background:#fff1f2; }
    .small-muted { color:#6c757d; }
  </style>
</head>

<body>
<div class="container py-4">
  <div class="card shadow-sm p-4">
    <h2 class="fw-bold text-primary mb-2">Multiplication Rapid-Fire Quiz</h2>
    <p class="text-muted">Bootstrap UI — numeric keyboard opens on mobile (type="tel").</p>

    <!-- START -->
    <div id="start-screen">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Max Multiplier (A)</label>
          <input id="maxMultiplier" type="number" class="form-control" value="12" min="1" max="50">
        </div>

        <div class="col-md-6">
          <label class="form-label">Max Multiplicand (B)</label>
          <input id="maxMultiplicand" type="number" class="form-control" value="12" min="1" max="50">
        </div>

        <div class="col-md-6">
          <label class="form-label">Number of Questions</label>
          <input id="numQuestions" type="number" class="form-control" value="12" min="1" max="200">
        </div>

        <div class="col-md-6">
          <label class="form-label">Time per Question (s)</label>
          <input id="timePerQuestion" type="number" class="form-control" value="8" min="2" max="60">
        </div>
      </div>

      <div class="text-center mt-4">
        <button id="startBtn" class="btn btn-primary px-4">Start</button>
        <button id="demoBtn" class="btn btn-outline-secondary px-4">Demo</button>
      </div>
    </div>

    <!-- QUIZ -->
    <div id="quiz-screen" style="display:none" class="mt-3">
      <div class="d-flex justify-content-between text-muted mb-2">
        <span id="progress"></span>
        <span id="timeLeft"></span>
      </div>

      <div class="question-box text-center mb-3">
        <div id="questionText" class="question mb-3"></div>

        <form id="answerForm" class="d-flex gap-2 justify-content-center">
          <input id="answerInput"
                 type="tel"
                 inputmode="numeric"
                 pattern="[0-9]*"
                 class="form-control text-center"
                 style="max-width:160px; font-size:1.2rem;"
                 aria-label="Answer" />
          <button class="btn btn-primary">OK</button>
        </form>

        <div class="mt-3 d-flex justify-content-between">
          <button id="skipBtn" class="btn btn-outline-secondary">Skip</button>
          <button id="endBtn" class="btn btn-danger">End</button>
        </div>
      </div>
    </div>

    <!-- RESULTS -->
    <div id="results-screen" style="display:none" class="mt-3">
      <h3 class="text-success">Results</h3>
      <p id="summaryText" class="text-muted"></p>

      <div class="row text-center g-2 mb-3">
        <div class="col">
          <div class="p-3 bg-light rounded">
            <div class="small-muted">Correct</div>
            <div id="correctCount" class="fw-bold fs-5">0</div>
          </div>
        </div>

        <div class="col">
          <div class="p-3 bg-light rounded">
            <div class="small-muted">Incorrect</div>
            <div id="incorrectCount" class="fw-bold fs-5">0</div>
          </div>
        </div>

        <div class="col">
          <div class="p-3 bg-light rounded">
            <div class="small-muted">Accuracy</div>
            <div id="accuracy" class="fw-bold fs-5">0%</div>
          </div>
        </div>

        <div class="col">
          <div class="p-3 bg-light rounded">
            <div class="small-muted">Avg Time</div>
            <div id="avgTime" class="fw-bold fs-5">0s</div>
          </div>
        </div>
      </div>

      <div class="text-center">
        <button id="reviewBtn" class="btn btn-primary">Review Answers</button>
        <button id="tryAgainBtn" class="btn btn-secondary">Try Again</button>
      </div>
    </div>

    <!-- REVIEW -->
    <div id="review-screen" style="display:none" class="mt-3">
      <h4>Answer Review</h4>
      <p id="reviewHeader" class="text-muted"></p>

      <div id="reviewList" class="list-group mb-3"></div>

      <div class="text-center">
        <button id="backBtn" class="btn btn-outline-secondary">Back</button>
        <button id="retrySameBtn" class="btn btn-primary">Retry Same</button>
      </div>
    </div>

  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  // Screen elements
  const startScreen = document.getElementById('start-screen');
  const quizScreen  = document.getElementById('quiz-screen');
  const resultsScreen = document.getElementById('results-screen');
  const reviewScreen  = document.getElementById('review-screen');

  // Inputs & controls
  const maxMultiplierEl   = document.getElementById('maxMultiplier');
  const maxMultiplicandEl = document.getElementById('maxMultiplicand');
  const numQuestionsEl    = document.getElementById('numQuestions');
  const timePerQuestionEl = document.getElementById('timePerQuestion');

  const startBtn = document.getElementById('startBtn');
  const demoBtn  = document.getElementById('demoBtn');
  const progressText = document.getElementById('progress');
  const timeLeftText = document.getElementById('timeLeft');
  const questionText = document.getElementById('questionText');
  const answerInput  = document.getElementById('answerInput');
  const answerForm   = document.getElementById('answerForm');
  const skipBtn = document.getElementById('skipBtn');
  const endBtn  = document.getElementById('endBtn');

  const summaryText = document.getElementById('summaryText');
  const correctCountEl = document.getElementById('correctCount');
  const incorrectCountEl = document.getElementById('incorrectCount');
  const accuracyEl   = document.getElementById('accuracy');
  const avgTimeEl    = document.getElementById('avgTime');
  const reviewBtn    = document.getElementById('reviewBtn');
  const tryAgainBtn  = document.getElementById('tryAgainBtn');

  const reviewList = document.getElementById('reviewList');
  const reviewHeader = document.getElementById('reviewHeader');
  const backBtn   = document.getElementById('backBtn');
  const retrySameBtn = document.getElementById('retrySameBtn');

  // State
  let questions = [];
  let answers = []; // {q, a, b, correctAnswer, givenAnswer, correct, timeTaken}
  let currentIndex = 0;
  let timer = null;
  let remaining = 0;
  let questionStartAt = 0;

  function show(screen){
    startScreen.style.display="none";
    quizScreen.style.display="none";
    resultsScreen.style.display="none";
    reviewScreen.style.display="none";
    screen.style.display="block";
  }

  function generateQuestions(maxA, maxB, count){
    const list = [];
    for(let i=0;i<count;i++){
      const a = Math.floor(Math.random()*maxA)+1;
      const b = Math.floor(Math.random()*maxB)+1;
      list.push({a,b});
    }
    return list;
  }

  function startQuiz(){
    // synchronous in click handler so mobile keyboard focus works
    const maxA = Math.max(1, Math.min(50, Number(maxMultiplierEl.value) || 12));
    const maxB = Math.max(1, Math.min(50, Number(maxMultiplicandEl.value) || 12));
    const total = Math.max(1, Math.min(200, Number(numQuestionsEl.value) || 12));

    questions = generateQuestions(maxA, maxB, total);
    answers = [];
    currentIndex = 0;

    show(quizScreen);
    startQuestion();
  }

  function startQuestion(){
    const q = questions[currentIndex];
    if(!q){ endQuiz(); return; }

    questionText.textContent = `${q.a} × ${q.b}`;
    progressText.textContent = `Question ${currentIndex+1} of ${questions.length}`;
    answerInput.value = '';

    // Focus synchronously (works when startQuiz is called on user gesture)
    try { answerInput.focus(); answerInput.select?.(); } catch(e){}

    remaining = Math.max(2, Math.min(60, Number(timePerQuestionEl.value) || 8));
    timeLeftText.textContent = `Time left: ${remaining}s`;
    questionStartAt = Date.now();

    if(timer) clearInterval(timer);
    timer = setInterval(() => {
      remaining--;
      if(remaining <= 0){
        clearInterval(timer);
        timer = null;
        submitAnswer('');
        return;
      }
      timeLeftText.textContent = `Time left: ${remaining}s`;
    }, 1000);
  }

  function submitAnswer(raw){
    if(timer){ clearInterval(timer); timer = null; }

    const q = questions[currentIndex];
    const correctAnswer = q.a * q.b;
    const given = raw !== undefined ? raw : (answerInput.value || '').trim();
    const numeric = given === '' ? null : Number(given);
    const correct = numeric === correctAnswer;

    const timeTaken = Math.round((Date.now() - questionStartAt)/1000);

    answers.push({ q:`${q.a}×${q.b}`, a:q.a, b:q.b, correctAnswer, givenAnswer:numeric, correct, timeTaken });

    currentIndex++;
    if(currentIndex >= questions.length) {
      setTimeout(endQuiz, 120);
    } else {
      setTimeout(startQuestion, 140);
    }
  }

  function endQuiz(){
    show(resultsScreen);
    const correctCount = answers.filter(a=>a.correct).length;
    const total = answers.length;
    const incorrectCount = total - correctCount;
    const accuracy = total ? Math.round((correctCount/total)*100) : 0;
    const avg = total ? (answers.reduce((s,r)=>s+r.timeTaken,0)/total).toFixed(1) : 0;

    summaryText.textContent = `You answered ${total} question(s).`;
    correctCountEl.textContent = correctCount;
    incorrectCountEl.textContent = incorrectCount;
    accuracyEl.textContent = accuracy + '%';
    avgTimeEl.textContent = avg + 's';
  }

  function renderReview(){
    reviewList.innerHTML = '';
    const correctCount = answers.filter(a=>a.correct).length;
    reviewHeader.textContent = `Correct: ${correctCount} / ${answers.length}`;

    answers.forEach((r,i)=>{
      // Each item shows: question, your answer, correct answer (if wrong), time taken, and label
      const item = document.createElement('div');
      item.className = 'list-group-item review-row ' + (r.correct ? 'correct' : 'wrong');

      const yourAns = (r.givenAnswer === null || r.givenAnswer === undefined) ? '—' : String(r.givenAnswer);
      const correctAns = String(r.correctAnswer);

      item.innerHTML = `
        <div class="d-flex w-100 justify-content-between">
          <h6 class="mb-1">${i+1}. ${r.q.replace('×',' × ')}</h6>
          <small class="text-muted">${r.timeTaken}s</small>
        </div>
        <div class="mb-1 small-muted">
          Your answer: <strong>${yourAns}</strong>
          ${ r.correct ? `<span class="badge bg-success ms-2">Correct</span>` :
            `<span class="badge bg-danger ms-2">Wrong</span> <span class="ms-3">Correct answer: <strong>${correctAns}</strong></span>` }
        </div>
      `;
      reviewList.appendChild(item);
    });
  }

  // Bind events
  startBtn.addEventListener('click', startQuiz);
  demoBtn.addEventListener('click', () => { maxMultiplierEl.value=5; maxMultiplicandEl.value=12; numQuestionsEl.value=10; timePerQuestionEl.value=6; startQuiz(); });

  answerForm.addEventListener('submit', (e)=>{ e.preventDefault(); submitAnswer(); });
  skipBtn.addEventListener('click', ()=>submitAnswer(''));
  endBtn.addEventListener('click', ()=>{ if(timer){ clearInterval(timer); timer=null; } endQuiz(); });

  reviewBtn.addEventListener('click', ()=>{ show(reviewScreen); renderReview(); });
  tryAgainBtn.addEventListener('click', ()=>{ show(startScreen); });
  backBtn.addEventListener('click', ()=>{ show(resultsScreen); });
  retrySameBtn.addEventListener('click', ()=>{ currentIndex=0; answers=[]; show(quizScreen); startQuestion(); });

  // Restrict input to digits and minus (if you allow negative answers)
  answerInput.addEventListener('input', (e)=>{ e.target.value = e.target.value.replace(/[^0-9\-]/g,''); });

  // Initial screen
  show(startScreen);
});
</script>
</body>
</html>
